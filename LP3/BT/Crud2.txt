// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

contract UserCRUD {
    struct User {
        uint256 id;
        string name;
    }

    User[] public users;
    uint256 public nextId = 0;

    event UserCreated(uint256 indexed id, string name);
    event UserUpdated(uint256 indexed id, string oldName, string newName);
    event UserDeleted(uint256 indexed id);

    // Create
    function create(string calldata name) external {
        require(bytes(name).length > 0, "Name required");
        users.push(User(nextId, name));
        emit UserCreated(nextId, name);
        nextId++;
    }

    // Read
    function read(uint256 id) external view returns (uint256, string memory) {
        uint256 index = _findIndex(id);
        return (users[index].id, users[index].name);
    }

    // Update
    function update(uint256 id, string calldata name) external {
        require(bytes(name).length > 0, "Name required");
        uint256 index = _findIndex(id);
        string memory old = users[index].name;
        users[index].name = name;
        emit UserUpdated(id, old, name);
    }

    // Delete
    function remove(uint256 id) external {
        uint256 index = _findIndex(id);
        // swap with last if not last, then pop
        uint256 lastIndex = users.length - 1;
        if (index != lastIndex) {
            users[index] = users[lastIndex];
        }
        users.pop();
        emit UserDeleted(id);
    }

    // Internal helper
    function _findIndex(uint256 id) internal view returns (uint256) {
        for (uint256 i = 0; i < users.length; i++) {
            if (users[i].id == id) {
                return i;
            }
        }
        revert("User does not exist");
    }
}
